<!DOCTYPE html>
<style>

.invisible {
  opacity: 0;
}

.visible {
}

</style>

<div id="videoHider" class="invisible">
<div id="videoHolder">
  You need Flash player 8+ and JavaScript enabled to view this video.
</div>
</div>

<div style="opacity: 0; position: absolute">
<div id="audioHolder"></div>
</div>

<button style="background-color: gray; border: 1px solid black; width: 425px" id="pause">Big ol' pause button</button>

<script type="text/javascript" src="swfobject.js"></script>    

<script type="text/javascript">

var data = window.location.hash.substr(1);
var config = data.split(":");

var params = { allowScriptAccess: "always" };
var atts = { id: "video" };
swfobject.embedSWF("http://www.youtube.com/apiplayer?enablejsapi=1&playerapiid=video&version=3", "videoHolder", "425", "356", "8", null, null, params, atts);

var atts = { id: "audio" };
swfobject.embedSWF("http://www.youtube.com/apiplayer?enablejsapi=1&playerapiid=audio&version=3", "audioHolder", "200", "200", "8", null, null, params, atts);


function YouTubeObject(playerId) {
  this.player = document.getElementById(playerId);
  this.state = -1;

  window["redirectorFor" + playerId] = function(event) { console.log(event, this); this.handleStateChange(event) }.bind(this);
  this.player.addEventListener("onStateChange", "redirectorFor" + playerId);

  this.stateChanged = undefined;
  this.handleStateChange = function(event) {
    if (this.stateChanged) {
      this.stateChanged(event);
    }
  }
}

var video;
var audio;

var paused = false;
var pause = document.getElementById("pause");

function togglePause(event) {
  if (paused) {
    paused = false;
    video.player.playVideo();
    audio.player.playVideo();
  } else {
    paused = true;
    video.player.pauseVideo(); 
    audio.player.pauseVideo(); 
  }
}

pause.addEventListener("click", togglePause);
document.addEventListener("keypress", function(event) { 
  if (event.charCode == 32) { togglePause(event); } 
  event.preventDefault(); 
  return false;
});

function onYouTubePlayerReady(playerId) {
  if (playerId == "video") {
    video = new YouTubeObject("video");
  } else {
    audio = new YouTubeObject("audio");
  }

  if (video && audio) {
    video.player.mute();
    audio.player.mute();
    video.stateChanged = waitForVideosToLoad;
    video.player.loadVideoById(config[0], 0, "default");
    audio.stateChanged = waitForVideosToLoad;
    audio.player.loadVideoById(config[1], 0, "hd720");
  }
}

var PLAYING = 1;
var PAUSED = 2;
var BUFFERING = 3;
var CUED = 5;

function waitForVideosToLoad(event) {
  console.log("waitForVideosToLoad", event, this);
  if (event == PLAYING) {
    this.state = event;
    if (video.state == PLAYING && audio.state == PLAYING) {
      setTimeout(playVideos, 0);
      video.stateChanged = function(event) { handleBuffering.call(this, audio, event); };
      audio.stateChanged = function(event) { handleBuffering.call(this, video, event); };
    }
  }
}

function handleBuffering(other, event) {
  if (event == BUFFERING && other.state != BUFFERING) {
    other.player.pauseVideo(); 
    this.state = BUFFERING;
  } else if (event == PLAYING && other.state != BUFFERING) {
    other.player.playVideo();
    this.state = PLAYING;
  }
}

function playVideos() {
  video.player.seekTo(0, true); 
  audio.player.seekTo(0, true);
  audio.player.unMute();
  document.getElementById("videoHider").setAttribute("class", "visible");
}
</script>
